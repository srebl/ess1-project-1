/*
*********************************************************************************************************
*
*                                        I2C BOARD SUPPORT PACKAGE
*
* Filename      : bsp_i2c.h
* Version       : V1.00
* Programmer(s) : Lukas Buchmayer
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                                             INCLUDE FILES
*********************************************************************************************************
*/

#ifndef  BSP_I2C_PRESENT
#define  BSP_I2C_PRESENT
#include <bsp_i2c.h>
#include <UART_1.h>
#include <includes.h>
/*
*********************************************************************************************************
*                                            LOCAL DEFINES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                           LOCAL CONSTANTS
*********************************************************************************************************
*/
                                                                  

/*
*********************************************************************************************************
*                                          LOCAL DATA TYPES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                            LOCAL TABLES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                       LOCAL GLOBAL VARIABLES
*********************************************************************************************************
*/



/*
*********************************************************************************************************
*                                      LOCAL FUNCTION PROTOTYPES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                            REGISTER BITS
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                     LOCAL CONFIGURATION ERRORS
*********************************************************************************************************
*/

void init_i2c(){
    I2C_1_Start(); 
}

void i2c_master_write(CPU_INT08U slave_address, CPU_INT08U reg, CPU_INT08U buffer, CPU_BOOLEAN send_stop){
    I2C_1_MasterSendStart(slave_address, I2C_1_WRITE_XFER_MODE);
    I2C_1_MasterWriteByte(reg);
    I2C_1_MasterWriteByte(buffer);
    if (send_stop){  
        I2C_1_MasterSendStop();
    }
}

void i2c_master_read(CPU_INT08U slave_address, CPU_INT08U reg, CPU_INT08U *buffer, CPU_INT08U len){
    CPU_INT08U i = 0;
    I2C_1_MasterSendStart(slave_address, I2C_1_WRITE_XFER_MODE);
    I2C_1_MasterWriteByte(reg);
    I2C_1_MasterSendRestart(slave_address, I2C_1_READ_XFER_MODE);
    while (i < len){   
        buffer[i] = I2C_1_MasterReadByte(I2C_1_ACK_DATA);
        i++;
    }
    buffer[i] = I2C_1_MasterReadByte(I2C_1_NAK_DATA);
    I2C_1_MasterSendStop();
}

#endif
